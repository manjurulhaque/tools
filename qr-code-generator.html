<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Advanced QR Code Generator</title>
		<!-- Bootstrap 5 CSS -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<style>
			body {
				background-color: #f8f9fa;
			}
			#qrcode {
				margin-top: 20px;
				display: flex;
				justify-content: center;
			}
		</style>
	</head>
	<body>
		<div class="container my-5">
			<div class="card shadow">
				<div class="card-body">
					<h2 class="text-center mb-4">Advanced QR Code Generator</h2>

					<div class="row g-3">
						<div class="col-md-12">
							<label for="text" class="form-label">Enter Text or URL</label>
							<input
								type="text"
								class="form-control"
								id="text"
								placeholder="https://example.com"
							/>
						</div>

						<div class="col-md-6">
							<label for="size" class="form-label">Size (px)</label>
							<input type="number" class="form-control" id="size" value="300" />
						</div>

						<div class="col-md-6">
							<label for="margin" class="form-label">Margin</label>
							<input
								type="number"
								class="form-control"
								id="margin"
								value="10"
							/>
						</div>

						<div class="col-md-6">
							<label for="dotColor" class="form-label">Dot Color</label>
							<input
								type="color"
								class="form-control form-control-color"
								id="dotColor"
								value="#000000"
								title="Choose dot color"
							/>
						</div>

						<div class="col-md-6">
							<label for="bgColor" class="form-label">Background Color</label>
							<input
								type="color"
								class="form-control form-control-color"
								id="bgColor"
								value="#ffffff"
								title="Choose background color"
							/>
						</div>

						<div class="col-md-6">
							<label for="dotStyle" class="form-label">Dot Style</label>
							<select class="form-select" id="dotStyle">
								<option value="rounded" selected>Rounded</option>
								<option value="dots">Dots</option>
								<option value="square">Square</option>
							</select>
						</div>

						<div class="col-md-6">
							<label for="errorCorrection" class="form-label"
								>Error Correction Level</label
							>
							<select class="form-select" id="errorCorrection">
								<option value="L">L - Low</option>
								<option value="M" selected>M - Medium</option>
								<option value="Q">Q - Quartile</option>
								<option value="H">H - High</option>
							</select>
						</div>

						<div class="col-md-12">
							<label for="logo" class="form-label"
								>Upload Logo (Optional)</label
							>
							<input
								type="file"
								class="form-control"
								id="logo"
								accept="image/*"
							/>
						</div>

						<div class="col-md-12">
							<label for="filename" class="form-label">Download Filename</label>
							<input
								type="text"
								class="form-control"
								id="filename"
								placeholder="qr-code"
							/>
						</div>
					</div>

					<div class="d-grid mt-4">
						<button class="btn btn-primary" id="generate-btn">
							Generate QR Code
						</button>
					</div>

					<div id="qrcode" class="my-4"></div>
					<div id="qr-preview" class="text-center text-muted small mb-3"></div>

					<div class="row">
						<div class="col-md-6 d-grid">
							<button
								class="btn btn-success"
								id="download-png"
								style="display: none"
							>
								Download PNG
							</button>
						</div>
						<div class="col-md-6 d-grid">
							<button
								class="btn btn-secondary"
								id="download-svg"
								style="display: none"
							>
								Download SVG
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Bootstrap JS Bundle -->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

		<!-- QR Code Styling Library -->
		<script src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>

		<script>
			const qrCodeContainer = document.getElementById("qrcode");
			const generateBtn = document.getElementById("generate-btn");
			const downloadPngBtn = document.getElementById("download-png");
			const downloadSvgBtn = document.getElementById("download-svg");
			const preview = document.getElementById("qr-preview");

			let qrCode;

			generateBtn.addEventListener("click", () => {
				const text =
					document.getElementById("text").value.trim() || "https://example.com";
				const size = parseInt(document.getElementById("size").value);
				const margin = parseInt(document.getElementById("margin").value);
				const dotColor = document.getElementById("dotColor").value;
				const bgColor = document.getElementById("bgColor").value;
				const dotStyle = document.getElementById("dotStyle").value;
				const errorCorrection =
					document.getElementById("errorCorrection").value;
				const filename =
					document.getElementById("filename").value.trim() || "qr-code";
				const logoFile = document.getElementById("logo").files[0];

				// Validation
				if (isNaN(size) || size <= 0 || isNaN(margin) || margin < 0) {
					alert("Please enter valid positive numbers for size and margin.");
					return;
				}

				qrCodeContainer.innerHTML = "";
				preview.textContent = "";

				const options = {
					width: size,
					height: size,
					data: text,
					image: "",
					margin: margin,
					qrOptions: {
						errorCorrectionLevel: errorCorrection,
					},
					dotsOptions: {
						color: dotColor,
						type: dotStyle,
					},
					backgroundOptions: {
						color: bgColor,
					},
					imageOptions: {
						crossOrigin: "anonymous",
						margin: 5,
					},
				};

				const generateQR = (opts) => {
					qrCode = new QRCodeStyling(opts);
					qrCode.append(qrCodeContainer);
					preview.innerHTML = `QR Code for: <code>${text}</code>`;
					downloadPngBtn.style.display = "block";
					downloadSvgBtn.style.display = "block";

					// Attach filename to download buttons
					downloadPngBtn.onclick = () =>
						qrCode.download({ name: filename, extension: "png" });
					downloadSvgBtn.onclick = () =>
						qrCode.download({ name: filename, extension: "svg" });
				};

				if (logoFile) {
					const reader = new FileReader();
					reader.onload = function (e) {
						options.image = e.target.result;
						generateQR(options);
					};
					reader.readAsDataURL(logoFile);
				} else {
					generateQR(options);
				}
			});
		</script>
	</body>
</html>
