<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced Barcode Generator (With QR)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- JsBarcode (1D barcodes) -->
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>

<!-- QRCode.js (QR only) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background: #eef2f6;
    padding: 20px;
}
.container {
    max-width: 680px;
    margin: auto;
    background: #ffffff;
    padding: 20px;
    border-radius: 8px;
}
label {
    display: block;
    margin-top: 12px;
    font-weight: bold;
}
input, select, button {
    width: 100%;
    padding: 8px;
    margin-top: 6px;
}
button {
    background: #0069d9;
    color: white;
    border: none;
    margin-top: 16px;
    cursor: pointer;
}
.preview {
    text-align: center;
    margin-top: 20px;
}
canvas {
    max-width: 100%;
}
.error {
    color: #b91c1c;
    margin-top: 10px;
}
.note {
    font-size: 13px;
    color: #555;
}
</style>
</head>

<body>
<div class="container">
    <h2>Advanced Barcode Generator</h2>

    <label>Barcode Type</label>
    <select id="format">
        <optgroup label="2D">
            <option value="QR">QR Code</option>
        </optgroup>

        <optgroup label="Code 128">
            <option value="CODE128">Code128</option>
            <option value="CODE128A">Code128 A</option>
            <option value="CODE128B">Code128 B</option>
            <option value="CODE128C">Code128 C</option>
        </optgroup>

        <optgroup label="Retail">
            <option value="EAN13">EAN-13</option>
            <option value="EAN8">EAN-8</option>
            <option value="UPC">UPC-A</option>
            <option value="UPCE">UPC-E</option>
        </optgroup>

        <optgroup label="Industrial">
            <option value="CODE39">Code39</option>
            <option value="CODE39EXT">Code39 Extended</option>
            <option value="ITF">ITF</option>
            <option value="ITF14">ITF-14</option>
            <option value="CODABAR">Codabar</option>
        </optgroup>

        <optgroup label="Specialty">
            <option value="MSI">MSI</option>
            <option value="MSI10">MSI10</option>
            <option value="MSI11">MSI11</option>
            <option value="MSI1010">MSI1010</option>
            <option value="MSI1110">MSI1110</option>
            <option value="pharmacode">Pharmacode</option>
        </optgroup>
    </select>

    <label>Value / Text</label>
    <input id="value" type="text" value="https://example.com">

    <label>Bar / Module Width</label>
    <input id="barWidth" type="number" value="2" min="1">

    <label>Bar / QR Size</label>
    <input id="barHeight" type="number" value="200" min="50">

    <label>Foreground Color</label>
    <input id="fgColor" type="color" value="#000000">

    <label>Background Color</label>
    <input id="bgColor" type="color" value="#ffffff">

    <label>Rotation</label>
    <select id="rotation">
        <option value="0">0°</option>
        <option value="90">90°</option>
        <option value="180">180°</option>
        <option value="270">270°</option>
    </select>

    <button onclick="generate()">Generate</button>
    <button onclick="downloadPNG()">Download PNG</button>

    <div id="error" class="error"></div>

    <div class="preview">
        <canvas id="output"></canvas>
    </div>

    <div class="note">
        QR Codes accept any text. Linear barcodes enforce strict validation.
    </div>
</div>

<script>
const output = document.getElementById("output");
const errorEl = document.getElementById("error");

function isNumeric(v) {
    return /^\d+$/.test(v);
}

function validate(format, value) {
    if (!value) return "Value is required.";

    if (format === "QR") return null;

    switch (format) {
        case "EAN13": return isNumeric(value) && [12,13].includes(value.length)
            ? null : "EAN-13 requires 12 or 13 digits.";
        case "EAN8": return isNumeric(value) && [7,8].includes(value.length)
            ? null : "EAN-8 requires 7 or 8 digits.";
        case "UPC": return isNumeric(value) && [11,12].includes(value.length)
            ? null : "UPC-A requires 11 or 12 digits.";
        case "UPCE": return isNumeric(value) && value.length >= 6 && value.length <= 8
            ? null : "UPC-E requires 6–8 digits.";
        case "CODE128C": return isNumeric(value) && value.length % 2 === 0
            ? null : "Code128C requires even-length numeric input.";
        case "ITF":
        case "ITF14": return isNumeric(value) && value.length % 2 === 0
            ? null : "ITF requires an even number of digits.";
        case "pharmacode":
            const n = Number(value);
            return isNumeric(value) && n >= 3 && n <= 131070
                ? null : "Pharmacode range: 3–131070.";
    }
    return null;
}

function generate() {
    const format = formatEl.value;
    const value = valueEl.value.trim();
    const size = +barHeightEl.value;
    const fg = fgColorEl.value;
    const bg = bgColorEl.value;
    const rotation = +rotationEl.value;

    errorEl.textContent = "";

    const err = validate(format, value);
    if (err) {
        errorEl.textContent = err;
        return;
    }

    if (format === "QR") {
        generateQR(value, size, fg, bg, rotation);
    } else {
        generateLinear(format, value, fg, bg, rotation);
    }
}

function generateQR(text, size, fg, bg, rotation) {
    const temp = document.createElement("div");
    new QRCode(temp, {
        text,
        width: size,
        height: size,
        colorDark: fg,
        colorLight: bg,
        correctLevel: QRCode.CorrectLevel.H
    });

    const qrCanvas = temp.querySelector("canvas");
    drawToOutput(qrCanvas, rotation, bg);
}

function generateLinear(format, value, fg, bg, rotation) {
    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");

    try {
        JsBarcode(svg, value, {
            format,
            width: +barWidthEl.value,
            height: +barHeightEl.value,
            lineColor: fg,
            background: bg,
            displayValue: true
        });
    } catch (e) {
        errorEl.textContent = e.message;
        return;
    }

    const img = new Image();
    img.onload = () => drawToOutput(img, rotation, bg);
    img.src = "data:image/svg+xml;base64," +
        btoa(new XMLSerializer().serializeToString(svg));
}

function drawToOutput(img, rotation, bg) {
    const ctx = output.getContext("2d");
    const rotated = rotation === 90 || rotation === 270;

    output.width = rotated ? img.height : img.width;
    output.height = rotated ? img.width : img.height;

    ctx.fillStyle = bg;
    ctx.fillRect(0, 0, output.width, output.height);

    ctx.save();
    ctx.translate(output.width / 2, output.height / 2);
    ctx.rotate(rotation * Math.PI / 180);
    ctx.drawImage(img, -img.width / 2, -img.height / 2);
    ctx.restore();
}

function downloadPNG() {
    if (!output.width) return alert("Generate first.");
    const a = document.createElement("a");
    a.href = output.toDataURL("image/png");
    a.download = "barcode.png";
    a.click();
}

/* Element shortcuts */
const formatEl = document.getElementById("format");
const valueEl = document.getElementById("value");
const barWidthEl = document.getElementById("barWidth");
const barHeightEl = document.getElementById("barHeight");
const fgColorEl = document.getElementById("fgColor");
const bgColorEl = document.getElementById("bgColor");
const rotationEl = document.getElementById("rotation");
</script>
</body>
</html>
